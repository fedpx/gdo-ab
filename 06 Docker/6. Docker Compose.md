# Задание
Создание веб-приложения на Flask и развёртывание через Docker Compose
1. Создайте веб-приложение на Flask:
	- В папке проекта создайте директорию арр и внутри неё файл арр.ру со следующим кодом:
```
# app.py 
from flask import Flask 
import psycopg2 

app = Flask(__name__) 

@app.route("/") 
def home():
	try:
		conn = psycopg2.connect( 
			dbname="mydatabase", # Замените на имя БДиз docker-compose.yml
			user="user", # Замените на пользователя из docker-compose.yml
			password="password", # Замените на пароль из docker-compose.yml
			host="db" # Замените на имя сервиса базы данных из docker-compose.yml
		)
		conn.close()
		return "Connected to the database successfully!" 
	except Exception as e: 
		return f"Error: {e}" 
if __name__ == "__main__": 
	app.run(host="0.0.0.0", port=5000) 
```
	- В той же папке создайте файл `requirements.txt`: 
```
flask 
psycopg2-binary
```
2. Создайте docker-compose.yml:
	- В корне проекта создайте файл docker-compose.yml для настройки двух сервисов: Flask-приложения и базы данных PostgreSQL.
	- Укажите параметры подключения к базе данных (POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB).
3. Запустите проект через Docker Compose:
	- Соберите и запустите контейнеры: docker-compose up -d 
	- Убедитесь, что Flask-приложение запущено и слушает на порту 5000.
4. Проверьте работу приложения:
	- Перейдите в браузере по адресу http://localhost:5000.
	- Убедитесь, что приложение подключается к базе данных и отображает сообщение о статусе соединения.

Конечный результат:
- Flask-приложение работает в одном контейнере и успешно взаимодействует с PostgreSQL в другом. 
- Данные базы сохраняются между перезапусками благодаря настройке тома.

---

# Собираем образ
## Пишем Dockerfile
В директории с файлами `app.py` и `requirements.txt` создаём `Dockerfile`. 
Содержимое Dockerfile:
```
FROM python:3.12-slim
WORKDIR /app
COPY ./requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY ./app.py .
EXPOSE 5000
CMD ["python", "app.py"]
```
## Собираем образ
Выполняем команду для сборки образа в директории с `Dockerfile`:
```
docker build -t flask_app .
```
# Запускаем контейнеры
В той же директории создаём `docker-compose.yml`.  
Содержимое `docker-compose.yml`:
```
services:
  app:
    image: flask_app
    ports:
      - "5000:5000"
    depends_on:
      - db

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: mydatabase
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:
```

Запускаем контейнеры и проверяем результат. 
```
# Запускаем контейнеры
docker compose up -d

# Проверяем логи, что нет ошибок
docker compose logs

# Проверяем доступность flask приложения на порту 5000
curl localhost:5000
```

![CleanShot 2025-09-09 at 16.18.18@2x.png](Files/CleanShot%202025-09-09%20at%2016.18.18@2x.png)